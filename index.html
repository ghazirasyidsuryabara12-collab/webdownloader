<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Social Media Downloader</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="hero">
        <div class="container hero__content">
            <div>
                <p class="hero__kicker">CLI Cepat & Fleksibel</p>
                <h1>Social Media Downloader</h1>
                <p class="hero__lead">
                    Unduh video publik dari YouTube, TikTok, Instagram, Facebook, X, Reddit, dan platform lain yang didukung yt-dlp. Pilih format yang Anda suka, simpan riwayat unduhan, dan gunakan lintas Windows maupun Linux.
                </p>
                <div class="hero__cta">
                    <a class="button" href="#mulai">Mulai Sekarang</a>
                    <a class="button button--ghost" href="https://nayandas69.github.io/Social-Media-Downloader" target="_blank" rel="noreferrer">Baca Dokumentasi</a>
                </div>
            </div>
            <div class="hero__card">
                <h2>Tersedia di PyPI</h2>
                <code>pip install social-media-downloader</code>
                <p>Butuh FFmpeg terpasang di sistem Anda.</p>
            </div>
        </div>
    </header>

    <main>
        <section id="demo" class="section section--highlight">
            <div class="container">
                <h2>Coba Langsung di Browser</h2>
                <p class="muted">
                    Tempel URL video publik dan biarkan backend Social Media Downloader mengunduhnya untuk Anda. Video akan tersedia untuk diunduh serta diputar langsung di halaman ini.
                </p>

                <form id="downloadForm" class="download-widget" autocomplete="off">
                    <label for="videoUrl">Tempel URL Video</label>
                    <div class="input-group">
                        <input id="videoUrl" name="url" type="url" required placeholder="https://www.youtube.com/watch?v=..." />
                        <button type="submit" class="button">Unduh</button>
                    </div>
                    <p class="helper">Hanya untuk konten publik. Pastikan backend berjalan dan dapat diakses.</p>
                </form>

                <div id="downloadStatus" class="status status--hidden"></div>

                <article id="resultCard" class="result-card hidden">
                    <img id="resultThumb" alt="Thumbnail" class="result-card__thumb hidden" />
                    <div class="result-card__body">
                        <h3 id="resultTitle"></h3>
                        <div class="result-card__actions">
                            <a id="resultLink" class="button" href="#" download>Unduh File</a>
                            <button id="copyLink" class="button button--ghost" type="button">Salin Tautan</button>
                        </div>
                        <video id="resultVideo" controls class="result-card__video hidden"></video>
                    </div>
                </article>
            </div>
        </section>

        <section id="fitur" class="section">
            <div class="container">
                <h2>Fitur Utama</h2>
                <div class="grid">
                    <article>
                        <h3>Multi Platform</h3>
                        <p>Validasi URL otomatis untuk domain populer dan dukungan penuh situs yang kompatibel dengan yt-dlp.</p>
                    </article>
                    <article>
                        <h3>Batch Download</h3>
                        <p>Tempel daftar tautan di berkas teks dan biarkan CLI mengunduhnya secara paralel dengan progress bar.</p>
                    </article>
                    <article>
                        <h3>Manajemen Format</h3>
                        <p>Pilih format video atau audio, ekstraksi MP3 via FFmpeg, serta koreksi otomatis apabila format tanpa audio dipilih.</p>
                    </article>
                    <article>
                        <h3>Riwayat Unduhan</h3>
                        <p>Semua aktivitas disimpan ke CSV lengkap dengan timestamp dan status, memudahkan audit maupun automasi.</p>
                    </article>
                    <article>
                        <h3>Pembaruan Cepat</h3>
                        <p>Periksa versi terbaru langsung dari PyPI dan terima info rilis terkini tanpa perlu keluar dari CLI.</p>
                    </article>
                    <article>
                        <h3>Open Source</h3>
                        <p>Kode berlisensi MIT dengan kontribusi aktif dari komunitas. Mudah dikustomisasi sesuai kebutuhan Anda.</p>
                    </article>
                </div>
            </div>
        </section>

        <section id="mulai" class="section section--alt">
            <div class="container">
                <h2>Cara Memulai</h2>
                <ol class="steps">
                    <li>
                        <h3>1. Instal FFmpeg</h3>
                        <p>Windows: unduh dari <a href="https://ffmpeg.org/download.html" target="_blank" rel="noreferrer">ffmpeg.org</a> dan tambahkan folder <code>bin</code> ke PATH. Linux: <code>sudo apt install ffmpeg</code>.</p>
                    </li>
                    <li>
                        <h3>2. Pasang Paket</h3>
                        <p>Gunakan pip: <code>pip install social-media-downloader</code>. Alternatif: jalankan langsung dari sumber atau gunakan image Docker.</p>
                    </li>
                    <li>
                        <h3>3. Jalankan CLI</h3>
                        <p>Ketik <code>smd</code> di terminal, pilih platform, tempel URL, dan pilih format. Untuk batch, siapkan berkas teks berisi daftar tautan.</p>
                    </li>
                </ol>
            </div>
        </section>

        <section class="section">
            <div class="container info-cards">
                <article>
                    <h2>Jalankan di Docker</h2>
                    <pre><code>docker run --rm -it \
  -v $(pwd)/media:/app/media \
  ghcr.io/nayandas69/social-media-downloader:latest</code></pre>
                    <p>Mount folder <code>media</code> agar hasil unduhan tersimpan di VPS Anda.</p>
                </article>
                <article>
                    <h2>Gunakan sebagai Library</h2>
                    <p>Import fungsi seperti <code>download_youtube_or_tiktok_video</code> langsung dari modul <code>smd</code> untuk automasi skrip Python.</p>
                </article>
            </div>
        </section>

        <section class="section section--alt">
            <div class="container">
                <h2>Paket Konten</h2>
                <ul class="pill-list">
                    <li>YouTube &amp; Shorts</li>
                    <li>TikTok &amp; Douyin</li>
                    <li>Instagram Reel, Feed, Stories</li>
                    <li>Facebook &amp; Meta Videos</li>
                    <li>X (Twitter) Media</li>
                    <li>Reddit &amp; Vimeo</li>
                </ul>
                <p class="muted">Daftar lengkap situs mengikuti dukungan resmi <a href="https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md" target="_blank" rel="noreferrer">yt-dlp</a>.</p>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container footer__content">
            <div>
                <h2>Siap Mengunduh?</h2>
                <p>Gabung komunitas, ajukan ide, atau laporkan bug melalui GitHub dan Discord.</p>
            </div>
            <div class="footer__links">
                <a href="https://github.com/nayandas69/Social-Media-Downloader" target="_blank" rel="noreferrer">GitHub</a>
                <a href="https://discord.gg/skHyssu" target="_blank" rel="noreferrer">Discord</a>
                <a href="mailto:nayanchandradas@hotmail.com">Email</a>
            </div>
        </div>
        <p class="footer__copy">&copy; 2025 Social Media Downloader. Proyek open source berlisensi MIT.</p>
    </footer>

    <script>
        const form = document.getElementById("downloadForm");
        const statusEl = document.getElementById("downloadStatus");
        const cardEl = document.getElementById("resultCard");
        const thumbEl = document.getElementById("resultThumb");
        const titleEl = document.getElementById("resultTitle");
        const linkEl = document.getElementById("resultLink");
        const videoEl = document.getElementById("resultVideo");
        const copyBtn = document.getElementById("copyLink");

        const API_BASE = window.SMD_API_BASE || ""; // Override via global var bila perlu

        function setStatus(message, type = "info") {
            statusEl.textContent = message;
            statusEl.className = `status status--${type}`;
        }

        function showResult(payload) {
            titleEl.textContent = payload.title || "Hasil Unduhan";
            linkEl.href = API_BASE + payload.file_url;
            linkEl.download = payload.filename;

            if (payload.thumbnail) {
                thumbEl.src = payload.thumbnail;
                thumbEl.classList.remove("hidden");
            } else {
                thumbEl.classList.add("hidden");
            }

            videoEl.src = API_BASE + payload.file_url;
            videoEl.classList.remove("hidden");

            cardEl.classList.remove("hidden");
        }

        form?.addEventListener("submit", async (event) => {
            event.preventDefault();
            const url = new FormData(form).get("url");
            if (!url) {
                setStatus("Masukkan URL yang valid.", "error");
                return;
            }

            cardEl.classList.add("hidden");
            thumbEl.classList.add("hidden");
            videoEl.classList.add("hidden");

            setStatus("Mengunduh video... mohon tunggu", "loading");

            try {
                const response = await fetch(`${API_BASE}/api/download`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ url }),
                });

                if (!response.ok) {
                    const { detail } = await response.json();
                    throw new Error(detail || "Gagal mengunduh");
                }

                const payload = await response.json();
                setStatus("Unduhan berhasil!", "success");
                showResult(payload);
            } catch (error) {
                console.error(error);
                setStatus(error.message || "Terjadi kesalahan", "error");
            }
        });

        copyBtn?.addEventListener("click", async () => {
            const url = linkEl.href;
            try {
                await navigator.clipboard.writeText(url);
                copyBtn.textContent = "Tautan Disalin";
                setTimeout(() => (copyBtn.textContent = "Salin Tautan"), 2000);
            } catch (error) {
                console.error(error);
            }
        });
    </script>
</body>
</html>
